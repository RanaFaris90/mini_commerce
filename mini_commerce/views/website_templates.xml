<odoo>
    <!-- ============================ -->
    <!-- SHOP PAGE -->
    <!-- ============================ -->
    <template id="shop_page" name="Mini Shop">
        <t t-call="website.layout">

            <!-- ðŸ”¥ GLOBAL ALERT MESSAGE -->
            <t t-if="request.session.get('mini_msg')">
                <div class="alert alert-dismissible fade show custom-alert" role="alert">
                    <t t-esc="request.session.get('mini_msg')"/>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                <t t-set="dummy" t-value="request.session.pop('mini_msg')"/>
            </t>

            <div class="container mt-4">

                <!-- FANCY TITLE WITH IMAGE -->
                <div class="d-flex justify-content-center align-items-center"
                     style="gap: 20px; margin: 30px 0 10px 0;">

                    <!-- IMAGE -->
                    <img src="/mini_commerce/static/src/img/images.png"
                         style="width:60px; height:60px; object-fit:cover; border-radius:10px;"
                         alt="Logo"/>

                    <!-- TITLE -->
                    <h1 style="font-size: 42px; font-weight: 800; margin: 0;">
                        <span style="
                        background: linear-gradient(90deg, #6f2dbd, #b5179e);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        font-family: 'Poppins', sans-serif;
                        letter-spacing: 1px;">
                            Rana Boutique
                        </span>
                    </h1>
                </div>

                <!-- LINE BELOW TITLE -->
                <div style="
                width: 800px;
                height: 5px;
                background: linear-gradient(90deg, #6f2dbd, #b5179e);
                margin: 0 auto 40px auto;
                border-radius: 10px;
            "></div>

                <!-- PRODUCT TYPE FILTER -->
                <form method="GET" action="/mini/shop" class="mb-4 text-center">
                    <select name="type"
                            class="form-select d-inline-block"
                            style="width:220px; display:inline-block;">

                        <option value="">All Products</option>

                        <option value="dress" t-att-selected="selected_type == 'dress'">Dress</option>
                        <option value="pants" t-att-selected="selected_type == 'pants'">Pants</option>
                        <option value="skirt" t-att-selected="selected_type == 'skirt'">Skirt</option>
                        <option value="shoes" t-att-selected="selected_type == 'shoes'">Shoes</option>
                        <option value="coat" t-att-selected="selected_type == 'coat'">Coat</option>

                    </select>

                    <button class="btn btn-primary ms-2">Filter</button>
                </form>

                <!-- PRODUCT GRID -->
                <div class="row">
                    <t t-foreach="products" t-as="p">
                        <div class="col-3 mb-4">
                            <div class="card p-2 shadow-sm product-card">

                                <!-- PRODUCT IMAGE -->
                                <t t-if="p.image">
                                    <img t-att-src="image_data_uri(p.image)"
                                         class="product-img mb-2"/>
                                </t>

                                <!-- FIXED TITLE AREA -->
                                <div class="title-box">
                                    <h5 class="product-title" t-esc="p.name"/>
                                </div>

                                <!-- FIXED PRICE AREA -->
                                <div class="price-box">
                                    <p>
                                        <strong t-esc="p.base_price"/>
                                        JOD
                                    </p>
                                </div>

                                <a t-att-href="'/mini/product/%s' % p.id"
                                   class="btn btn-primary btn-sm w-100 mt-auto">
                                    View
                                </a>

                            </div>
                        </div>
                    </t>
                </div>

            </div>

            <!-- ðŸ”¥ STYLE FIXES -->
            <style>
                /* Alert Style */
                .custom-alert {
                background: linear-gradient(90deg, #6f2dbd, #b5179e);
                color: white;
                font-weight: 600;
                padding: 14px 18px;
                border-radius: 8px;
                font-size: 15px;
                letter-spacing: 0.5px;
                margin-bottom: 20px;
                box-shadow: 0px 4px 15px rgba(111, 45, 189, 0.2);
                }

                .btn-close {
                filter: brightness(0) invert(1);
                }

                .product-card {
                height: 460px !important;
                display: flex;
                flex-direction: column;
                }

                .product-img {
                width: 100%;
                height: 300px;
                object-fit: cover;
                border-radius: 10px;
                }

                .title-box {
                height: 50px;
                overflow: hidden;
                }

                .product-title {
                font-size: 15px;
                font-weight: 600;
                line-height: 1.2;
                }

                .price-box {
                height: 30px;
                }
            </style>

        </t>
    </template>
    <!-- ============================ -->
    <!-- PRODUCT PAGE -->
    <!-- ============================ -->
    <template id="product_page" name="Product Page">
        <t t-call="website.layout">
            <div class="container mt-5">

                <div class="row">

                    <!-- LEFT : PRODUCT IMAGE -->
                    <div class="col-md-6">
                        <img id="main_image"
                             t-if="product.image"
                             t-att-data-original="'data:image/png;base64,%s' % product.image.decode()"
                             t-att-src="'data:image/png;base64,%s' % product.image.decode()"
                             class="img-fluid"
                             style="border-radius: 10px; max-height: 600px; object-fit: cover;"/>
                    </div>

                    <!-- RIGHT : INFO -->
                    <div class="col-md-6">

                        <h2 t-esc="product.name" style="font-weight: bold;"/>
                        <p style="font-size: 18px; color: #666;" t-esc="product.description"/>

                        <h4 class="mt-3">
                            Price:
                            <span style="color:#6f2dbd; font-weight:bold;">
                                <t t-esc="product.base_price"/>
                                JOD
                            </span>
                        </h4>

                        <input type="hidden" id="product_id" t-att-value="product.id"/>

                        <!-- Select Color -->
                        <h5 class="mt-4">Select Color</h5>
                        <select name="variant_id" id="variant_select" class="form-control">
                            <t t-foreach="product.variant_ids" t-as="v">
                                <option t-att-value="v.id"
                                        t-att-data-img="'data:image/png;base64,%s' % v.image.decode() if v.image else ''"
                                        t-att-data-qty="v.quantity_on_hand">
                                    <t t-esc="v.color"/>
                                    -
                                    <t t-esc="v.size"/>
                                    ( +
                                    <t t-esc="v.extra_price"/>
                                    JOD )
                                </option>
                            </t>
                        </select>
                        <!-- Quantity -->
                        <h5>Quantity</h5>
                        <input id="qty" type="number" class="form-control mb-3" value="1" min="1"/>

                        <!-- ADD TO CART BUTTON -->
                        <button type="button"
                                class="btn btn-success btn-lg mt-3 w-100"
                                onclick="addToCartJS()">
                            Add to Cart
                        </button>

                    </div>
                </div>

                <!-- ================= JS TO CHANGE IMAGE ================= -->
                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                    const select = document.getElementById("variant_select");
                    const img = document.getElementById("main_image");

                    select.addEventListener("change", function () {
                    const selected = select.options[select.selectedIndex];
                    const newImg = selected.getAttribute("data-img");

                    if (newImg) {
                    img.src = newImg;
                    } else {
                    img.src = img.getAttribute("data-original");
                    }
                    });
                    });
                </script>
                <!-- SweetAlert -->
                <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

                <!-- ================= ADD TO CART VIA FETCH ================= -->
                <script>
                    function addToCartJS() {
                    const product_id = document.getElementById("product_id").value;
                    const variant_id = document.getElementById("variant_select").value;
                    const qty = document.getElementById("qty").value;

                    const params = new URLSearchParams();
                    params.append('product_id', product_id);
                    params.append('variant_id', variant_id);
                    params.append('qty', qty);

                    // 1) CHECK STOCK
                    fetch('/mini/check_stock_js', {
                    method: 'POST',
                    body: params,
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    credentials: 'include'
                    })
                    .then(r => r.json())
                    .then(response => {

                    if (response.error) {
                    Swal.fire({ icon: 'null', text: response.message });
                    return;
                    }

                    // 2) ADD TO CART
                    fetch('/mini/add_to_cart_js', {
                    method: 'POST',
                    body: params,
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    credentials: 'include'
                    })
                    .then(r => r.json())
                    .then(() => {
                    Swal.fire({
                    icon: 'success',
                    text: 'Item added!',
                    }).then(() => window.location = "/mini/cart");
                    });

                    });
                    }
                </script>
            </div>
        </t>
    </template>


    <!-- ============================ -->
    <!-- CART PAGE -->
    <!-- ============================ -->
    <template id="cart_page" name="Cart Page">
        <t t-call="website.layout">
            <div class="container mt-4">

                <!-- SUCCESS MESSAGE (AFTER ADD TO CART) -->
                <t t-if="request.session.get('mini_msg')">
                    <div class="alert alert-success">
                        <t t-esc="request.session.get('mini_msg')"/>
                    </div>
                    <t t-set="dummy" t-value="request.session.pop('mini_msg')"/>
                </t>
                <!-- END MESSAGE -->

                <h2>Your Cart</h2>
                <style>
                    /* Dark Table Style */
                    .mini-dark-table {
                    background: #2b2b2b !important;
                    color: #fff !important;
                    border-color: #444 !important;
                    }

                    .mini-dark-table th {
                    background: #3a3a3a !important;
                    color: #fff !important;
                    font-weight: 600;
                    }

                    .mini-dark-table td {
                    background: #2b2b2b !important;
                    border-color: #444 !important;
                    }

                    .mini-dark-table tr:hover td {
                    background: #383838 !important;
                    }
                </style>

                <t t-if="items">
                    <table class="table table-bordered mini-dark-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Variant</th>
                                <th>Qty</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="items" t-as="line">
                                <tr>
                                    <td t-esc="line['product'].name"/>
                                    <td>
                                        <t t-if="line['variant']">

                                            <t t-esc="line['variant'].color"/>
                                        </t>
                                        <t t-else="">-</t>
                                    </td>
                                    <td t-esc="line['qty']"/>
                                    <td>
                                        <t t-esc="line['subtotal']"/>
                                        JOD
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>

                    <h3>Total:
                        <t t-esc="total"/>
                        JOD
                    </h3>

                    <div class="d-flex align-items-center mt-3" style="gap: 10px;">
                        <a href="/mini/checkout" class="btn btn-primary">
                            Proceed to Checkout
                        </a>

                        <a href="/mini/shop" class="btn btn-secondary">
                            Add New Products
                        </a>
                    </div>

                </t>

                <t t-if="not items">
                    <p>Your cart is empty.</p>
                </t>

            </div>
        </t>
    </template>

    <!-- ============================ -->
    <!-- CHECKOUT PAGE -->
    <!-- ============================ -->
    <template id="checkout_page" name="Checkout Page">
        <t t-call="website.layout">
            <div class="container mt-4">
                <h2>Checkout</h2>

                <form action="/mini/checkout/submit" method="POST">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                    <label>Name</label>
                    <input name="name" required="1" class="form-control mb-3"/>

                    <label>Email</label>
                    <input name="email" class="form-control mb-3"/>

                    <label>Phone</label>
                    <input name="phone" class="form-control mb-3"/>

                    <button class="btn btn-success">Confirm Order</button>

                </form>

            </div>
        </t>
    </template>

    <!-- ============================ -->
    <!-- CONFIRM PAGE -->
    <!-- ============================ -->
    <template id="confirm_page" name="Confirmation Page">
        <t t-call="website.layout">
            <div class="container d-flex justify-content-center align-items-center"
                 style="min-height:75vh;">

                <div class="text-center">

                    <!-- IMAGE -->
                    <img src="/mini_commerce/static/src/img/icon.jpg"
                         style="width:400px; max-width:100%; margin-bottom:25px;"
                         alt="Thank You"/>

                    <!-- TITLE -->
                    <h2 style="
                    font-size: 34px;
                    font-weight: 800;
                    background: linear-gradient(90deg, #6f2dbd, #b5179e);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                ">
                        Thank You for Your Order! ðŸ’œ
                    </h2>

                    <!-- MESSAGE -->
                    <p style="
                    font-size: 18px;
                    margin-top: 10px;
                    color: #555;
                ">
                        Your order has been successfully placed.
                        <br/>
                        It will be delivered to you within
                        <span style="color:#6f2dbd; font-weight:600;">3 days</span>.
                    </p>
                    <p style="font-size: 16px;">
                        Total Amount:
                        <strong style="color:#6f2dbd;">
                            <t t-esc="order.total"/>
                            JOD
                        </strong>
                    </p>

                    <!-- BUTTON -->
                    <a href="/mini/shop"
                       class="btn btn-primary mt-4"
                       style="
                       background: linear-gradient(90deg, #6f2dbd, #b5179e);
                       border: none;
                       padding: 10px 25px;
                       font-size: 16px;
                       border-radius: 8px;
                   ">
                        Back to Shop
                    </a>

                </div>

            </div>
        </t>
    </template>


    <template id="mini_backend_bg" inherit_id="web.layout">
        <xpath expr="//body" position="attributes">
            <attribute name="style">
                background-image: url('/mini_commerce/static/src/img/bg.avif') !important;
                background-size: cover !important;
                background-position: center !important;
                background-repeat: no-repeat !important;
            </attribute>
        </xpath>
    </template>

</odoo>
